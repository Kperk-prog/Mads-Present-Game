<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elf & Presents</title>
  <style>
    html, body { height: 100%; margin: 0; background:#0b1020; display:grid; place-items:center; }
    canvas { image-rendering: pixelated; image-rendering: crisp-edges; border: 2px solid #2b3355; background:#0f1730; }
    .hud {
      width: min(640px, 94vw);
      color: #cfe3ff;
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin-top: 10px;
      opacity: 0.95;
      text-align: center;
    }
    kbd {
      background:#1e2644; border:1px solid #3a4475; border-bottom-color:#252f57;
      padding:2px 6px; border-radius:6px; font-weight:600;
    }

    /* PDF overlay */
    .overlay {
      position: fixed; inset: 0;
      display: none;
      background: rgba(0,0,0,0.65);
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 999;
    }
    .overlay.show { display: flex; }
    .modal {
      width: min(900px, 96vw);
      height: min(600px, 86vh);
      background: #0f1730;
      border: 2px solid #2b3355;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 14px 60px rgba(0,0,0,0.55);
      display: grid;
      grid-template-rows: auto 1fr;
    }
    .modalHeader {
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 12px;
      background: #0b1020;
      border-bottom: 1px solid #2b3355;
      color: #cfe3ff;
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .btn {
      cursor: pointer;
      background:#1e2644;
      border:1px solid #3a4475;
      color:#cfe3ff;
      padding:6px 10px;
      border-radius:10px;
      font-weight:600;
    }
    .btn:hover { filter: brightness(1.08); }
    .pdfFrame { width: 100%; height: 100%; border: 0; background: #0f1730; }
  </style>
</head>
<body>
  <div>
    <canvas id="game" width="320" height="240"></canvas>
    <div class="hud">
      Move: <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> / Arrows ‚Ä¢ Open: <kbd>E</kbd>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalHeader">
        <div><b>üéÅ Correct Gift!</b> (opening <code>gift.pdf</code>)</div>
        <div style="display:flex; gap:10px;">
          <button class="btn" id="openNewTabBtn">Open in new tab</button>
          <button class="btn" id="closeBtn">Close</button>
        </div>
      </div>
      <iframe class="pdfFrame" id="pdfFrame" title="Gift PDF"></iframe>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  // PDF overlay
  const overlay = document.getElementById("overlay");
  const closeBtn = document.getElementById("closeBtn");
  const openNewTabBtn = document.getElementById("openNewTabBtn");
  const pdfFrame = document.getElementById("pdfFrame");

  // Put a PDF named "gift.pdf" next to this HTML file
  const GIFT_PDF_URL = "gift.pdf";

  function showPdfOverlay() {
    pdfFrame.src = GIFT_PDF_URL;
    overlay.classList.add("show");
  }
  function hidePdfOverlay() {
    overlay.classList.remove("show");
    pdfFrame.src = "about:blank";
  }
  closeBtn.addEventListener("click", hidePdfOverlay);
  overlay.addEventListener("click", (e) => { if (e.target === overlay) hidePdfOverlay(); });
  openNewTabBtn.addEventListener("click", () => window.open(GIFT_PDF_URL, "_blank", "noopener,noreferrer"));

  // Scale canvas up crisply
  const BASE_W = canvas.width, BASE_H = canvas.height;
  function fit() {
    const maxW = Math.min(640, window.innerWidth * 0.94);
    const maxH = Math.min(480, window.innerHeight * 0.75);
    const s = Math.max(1, Math.floor(Math.min(maxW / BASE_W, maxH / BASE_H)));
    canvas.style.width = (BASE_W * s) + "px";
    canvas.style.height = (BASE_H * s) + "px";
  }
  window.addEventListener("resize", fit);
  fit();

  // Input
  const keys = new Set();
  window.addEventListener("keydown", (e) => {
    keys.add(e.key.toLowerCase());
    if (["arrowup","arrowdown","arrowleft","arrowright"," "].includes(e.key.toLowerCase())) e.preventDefault();
  });
  window.addEventListener("keyup", (e) => keys.delete(e.key.toLowerCase()));

  // Helpers
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const rectsOverlap = (a,b) =>
    a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;

  // Elf
  const elf = { x: 152, y: 200, w: 12, h: 14, speed: 70, dir: "up", step: 0, stepTimer: 0 };

  // ‚úÖ 4 presents: 3 wrong, 1 correct
  const presents = [
    { x:  70, y:  70, w: 14, h: 12, opened:false, openAnim:0, kind:"wrong"   },
    { x: 230, y:  80, w: 14, h: 12, opened:false, openAnim:0, kind:"wrong"   },
    { x:  90, y: 150, w: 14, h: 12, opened:false, openAnim:0, kind:"wrong"   },
    { x: 154, y:  70, w: 14, h: 12, opened:false, openAnim:0, kind:"correct" },
  ];

  // Some trees (walls)
  const walls = [
    {x: 40, y: 40, w: 18, h: 18},
    {x: 260, y: 54, w: 18, h: 18},
    {x: 62, y: 150, w: 18, h: 18},
    {x: 242, y: 170, w: 18, h: 18},
  ];

  // Banner message
  let bannerText = "";
  let bannerTimer = 0;
  function showBanner(text, seconds=2.2) { bannerText = text; bannerTimer = seconds; }

  // Sparkles
  const particles = [];
  function spawnSparkles(cx, cy, n=18) {
    for (let i=0;i<n;i++){
      particles.push({
        x: cx + (Math.random()*10-5),
        y: cy + (Math.random()*8-4),
        vx: (Math.random()*2-1) * 35,
        vy: -(20 + Math.random()*55),
        life: 0.6 + Math.random()*0.5,
        t: 0,
        size: 1 + Math.floor(Math.random()*2)
      });
    }
  }

  let last = performance.now();
  requestAnimationFrame(function loop(now){
    const dt = Math.min(0.033, (now - last) / 1000);
    last = now;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  });

  function update(dt) {
    // Freeze movement while PDF overlay is open
    if (overlay.classList.contains("show")) return;

    // Movement
    let mx = 0, my = 0;
    const up = keys.has("w") || keys.has("arrowup");
    const down = keys.has("s") || keys.has("arrowdown");
    const left = keys.has("a") || keys.has("arrowleft");
    const right = keys.has("d") || keys.has("arrowright");
    if (up) my -= 1;
    if (down) my += 1;
    if (left) mx -= 1;
    if (right) mx += 1;

    if (mx || my) {
      const len = Math.hypot(mx, my) || 1;
      mx /= len; my /= len;

      if (Math.abs(my) >= Math.abs(mx)) elf.dir = (my < 0 ? "up" : "down");
      else elf.dir = (mx < 0 ? "left" : "right");

      const next = { x: elf.x, y: elf.y, w: elf.w, h: elf.h };

      // X move
      next.x = clamp(next.x + mx * elf.speed * dt, 2, 320 - elf.w - 2);
      let blockedX = false;
      for (const w of walls) if (rectsOverlap(next, w)) { blockedX = true; break; }
      if (!blockedX) elf.x = next.x;

      // Y move
      next.x = elf.x;
      next.y = clamp(next.y + my * elf.speed * dt, 2, 240 - elf.h - 2);
      let blockedY = false;
      for (const w of walls) if (rectsOverlap(next, w)) { blockedY = true; break; }
      if (!blockedY) elf.y = next.y;

      // Walk animation
      elf.stepTimer += dt;
      if (elf.stepTimer > 0.12) { elf.stepTimer = 0; elf.step = (elf.step + 1) % 2; }
    } else {
      elf.step = 0; elf.stepTimer = 0;
    }

    // Banner timer
    if (bannerTimer > 0) {
      bannerTimer -= dt;
      if (bannerTimer <= 0) { bannerText = ""; bannerTimer = 0; }
    }

    // Interact on E
    if (keys.has("e")) {
      const elfRect = { x: elf.x, y: elf.y, w: elf.w, h: elf.h };

      for (const p of presents) {
        if (p.opened) continue;
        const zone = { x: p.x - 6, y: p.y - 6, w: p.w + 12, h: p.h + 12 };

        if (rectsOverlap(elfRect, zone)) {
          p.opened = true;
          p.openAnim = 0;
          spawnSparkles(p.x + p.w/2, p.y + p.h/2, 18);

          if (p.kind === "wrong") {
            showBanner("OOPS WRONG GIFT!", 2.4);
          } else {
            showBanner("YES! CORRECT GIFT!", 1.2);
            setTimeout(showPdfOverlay, 350);
          }
          break;
        }
      }
    }

    // Present opening animation
    for (const p of presents) {
      if (p.opened && p.openAnim < 1) {
        p.openAnim = Math.min(1, p.openAnim + dt * 2.2);
        if (Math.random() < 0.08) spawnSparkles(p.x + p.w/2, p.y + p.h/2, 1);
      }
    }

    // Particles
    for (let i = particles.length - 1; i >= 0; i--) {
      const q = particles[i];
      q.t += dt;
      q.x += q.vx * dt;
      q.y += q.vy * dt;
      q.vy += 140 * dt;
      if (q.t >= q.life) particles.splice(i, 1);
    }
  }

  function draw() {
    // Snow tiles
    for (let y=0; y<240; y+=16){
      for (let x=0; x<320; x+=16){
        const alt = ((x/16 + y/16) % 2) === 0;
        ctx.fillStyle = alt ? "#e6f3ff" : "#d7ecff";
        ctx.fillRect(x,y,16,16);
      }
    }

    // Trees
    for (const w of walls) drawTree(w.x, w.y);

    // ‚úÖ Draw ALL presents
    for (const p of presents) drawPresent(p);

    // Elf
    drawElf(elf);

    // Sparkles
    for (const p of particles) {
      const a = 1 - (p.t / p.life);
      ctx.fillStyle = `rgba(255, 246, 180, ${a})`;
      ctx.fillRect(p.x|0, p.y|0, p.size, p.size);
    }

    // Prompt if near any unopened present
    const elfRect = { x: elf.x, y: elf.y, w: elf.w, h: elf.h };
    for (const p of presents) {
      if (p.opened) continue;
      const zone = { x: p.x - 10, y: p.y - 10, w: p.w + 20, h: p.h + 20 };
      if (rectsOverlap(elfRect, zone)) {
        drawTextCentered("Press E to open!", p.x + p.w/2, p.y - 10);
        break;
      }
    }

    // Banner
    if (bannerText) {
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.45)";
      ctx.fillRect(0, 0, 320, 18);
      ctx.font = "10px monospace";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "#ffffff";
      ctx.fillText(bannerText, 160, 9);
      ctx.restore();
    }

    // Vignette
    const g = ctx.createRadialGradient(160, 120, 40, 160, 120, 170);
    g.addColorStop(0, "rgba(0,0,0,0)");
    g.addColorStop(1, "rgba(0,0,0,0.25)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,320,240);
  }

  function drawTextCentered(text, x, y) {
    ctx.save();
    ctx.font = "10px monospace";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillText(text, x+1, y+1);
    ctx.fillStyle = "#1a2240";
    ctx.fillText(text, x, y);
    ctx.restore();
  }

  function drawTree(x, y) {
    ctx.fillStyle = "#6b3f2a";
    ctx.fillRect(x+7, y+11, 4, 6);
    ctx.fillStyle = "#1f7a3a";
    ctx.fillRect(x+2, y+2, 14, 10);
    ctx.fillStyle = "#2aa24b";
    ctx.fillRect(x+4, y+4, 10, 6);
    ctx.fillStyle = "#f3fbff";
    ctx.fillRect(x+3, y+1, 12, 3);
    ctx.fillStyle = "rgba(0,0,0,0.12)";
    ctx.fillRect(x, y, 18, 18);
  }

  function drawPresent(p) {
    ctx.fillStyle = "rgba(0,0,0,0.18)";
    ctx.fillRect(p.x+1, p.y+9, p.w, 4);

    // Wrong gifts are blue, correct is red
    const boxColor = (p.kind === "correct") ? "#c4312f" : "#2f6fd6";
    const lidColor = (p.kind === "correct") ? "#b12828" : "#285fb6";

    ctx.fillStyle = boxColor;
    ctx.fillRect(p.x, p.y+2, p.w, p.h);

    ctx.fillStyle = "#f0d35a";
    ctx.fillRect(p.x + (p.w/2|0) - 1, p.y+2, 2, p.h);
    ctx.fillRect(p.x, p.y + 6, p.w, 2);

    const t = p.openAnim;
    if (!p.opened) {
      ctx.fillStyle = lidColor;
      ctx.fillRect(p.x-1, p.y, p.w+2, 4);
    } else {
      const lift = (t * 10);
      const shrink = (t * 6);
      ctx.fillStyle = lidColor;
      ctx.fillRect((p.x-1 + shrink/2)|0, (p.y - lift)|0, (p.w+2 - shrink)|0, 4);
    }

    ctx.fillStyle = "#f6e07a";
    ctx.fillRect(p.x + (p.w/2|0) - 3, p.y - 1, 2, 2);
    ctx.fillRect(p.x + (p.w/2|0) + 1, p.y - 1, 2, 2);
  }

  function drawElf(e) {
    const step = e.step;
    ctx.fillStyle = "rgba(0,0,0,0.18)";
    ctx.fillRect((e.x+2)|0, (e.y+12)|0, 8, 3);

    ctx.fillStyle = "#4a2b1b";
    ctx.fillRect((e.x+2)|0, (e.y+11 + step)|0, 3, 3);
    ctx.fillRect((e.x+7)|0, (e.y+11 + (1-step))|0, 3, 3);

    ctx.fillStyle = "#2aa24b";
    ctx.fillRect((e.x+2)|0, (e.y+6)|0, 8, 6);

    ctx.fillStyle = "#1a1a1a";
    ctx.fillRect((e.x+2)|0, (e.y+9)|0, 8, 1);

    ctx.fillStyle = "#2fbd57";
    ctx.fillRect((e.x+1)|0, (e.y+7)|0, 1, 2);
    ctx.fillRect((e.x+10)|0, (e.y+7)|0, 1, 2);

    ctx.fillStyle = "#ffd7c7";
    ctx.fillRect((e.x+3)|0, (e.y+2)|0, 6, 4);

    ctx.fillStyle = "#d2462e";
    ctx.fillRect((e.x+2)|0, (e.y+1)|0, 8, 3);
    ctx.fillRect((e.x+2)|0, (e.y+2)|0, 1, 3);
    ctx.fillRect((e.x+9)|0, (e.y+2)|0, 1, 3);

    ctx.fillStyle = "#1f7a3a";
    ctx.fillRect((e.x+4)|0, (e.y)|0, 4, 2);
    ctx.fillRect((e.x+7)|0, (e.y+1)|0, 2, 1);

    ctx.fillStyle = "#1a2240";
    ctx.fillRect((e.x+4)|0, (e.y+3)|0, 1, 1);
    ctx.fillRect((e.x+7)|0, (e.y+3)|0, 1, 1);

    ctx.fillStyle = "#f2b6a0";
    if (e.dir === "up") ctx.fillRect((e.x+6)|0, (e.y+2)|0, 1, 1);
    if (e.dir === "down") ctx.fillRect((e.x+6)|0, (e.y+5)|0, 1, 1);
    if (e.dir === "left") ctx.fillRect((e.x+3)|0, (e.y+4)|0, 1, 1);
    if (e.dir === "right") ctx.fillRect((e.x+8)|0, (e.y+4)|0, 1, 1);
  }
})();
</script>
</body>
</html>
